# 功能變更摘要

## 2025年11月18日 - 完善圖片上傳功能與文件化

*   **新增 (Added):**
    *   **專案說明文件:** 新增 `PROJECT_DOCUMENTATION.md` 檔案，提供對整體專案架構、核心模組、執行流程及設計理念的深入解說，以利於未來的維護與開發。
    *   **圖片上傳資料夾:** 建立 `uploads/` 資料夾，作為儲存使用者上傳圖片的指定位置。
    *   **上傳路徑設定:** 在 `config.py` 中新增 `UPLOAD_FOLDER` 設定，將上傳路徑集中管理，提高程式碼的可維護性。

*   **變更 (Changed):**
    *   **強化圖片上傳路由:**
        *   修改 `core/routes.py` 中的 `/generate-quiz-from-image` 路由。
        *   引入 `werkzeug.utils.secure_filename` 來過濾並確保上傳的檔案名稱是安全的。
        *   現在，路由會先將上傳的圖片檔案儲存到 `uploads/` 資料夾，然後才將**檔案路徑**傳遞給後續的 AI 分析模組，而不是直接在記憶體中處理。這使得流程更穩健，也方便未來進行除錯。
    *   **版本控制忽略:** 更新 `.gitignore` 檔案，加入 `uploads/` 規則，確保使用者上傳的圖片不會被意外提交到 Git 版本控制中。

---

## 2025年11月17日 - 新增圖片生成測驗功能

*   **新增功能:**
    *   **圖片測驗生成頁面:** 在 `/image-quiz-generator` 新增了一個專門的頁面，允許使用者上傳包含數學題目的圖片，並附上文字說明。
    *   **後端處理邏輯:** 建立了新的 API 端點 `/generate-quiz-from-image`，能夠接收上傳的圖片和文字。
    *   **AI 整合:**
        *   在 `core/ai_analyzer.py` 中新增 `generate_quiz_from_image` 函式。
        *   此函式利用多模態 AI 模型分析圖片內容和使用者描述，以生成相關的測驗題目。
        *   AI 回應的格式被設計為結構化的 JSON，包含問題、選項和正確答案。
    *   **前端互動:**
        *   使用者提交表單後，頁面會以非同步方式 (AJAX) 發送請求。
        *   在等待 AI 回應時，會顯示一個讀取中的動畫，提升使用者體驗。
        *   成功獲取測驗後，會動態地將題目和答案呈現在頁面上，形成一個簡單的問答測驗模式。

*   **修改原因:**
    *   此功能擴展了應用的核心能力，從原有的文字基礎題目生成，升級為支援圖片的多模態題目生成。
    *   讓使用者可以更方便地利用手邊的教材（如課本、講義的截圖）來建立練習測驗，增加了應用的實用性和互動性。

---

## 2025年11月16日 - 修正「生成相似題」功能按鈕位置

*   **修改說明:**
    *   將「生成相似題」功能的入口按鈕從練習頁面 (`templates/index.html`) 移至儀表板頁面 (`templates/dashboard.html`)。
    *   修正了 `templates/dashboard.html` 中按鈕的 `url_for` 連結，確保其正確導向 `practice.similar_questions_page` 路由。
    *   為儀表板上的新按鈕添加了視覺樣式。
    *   將 `templates/index.html` 恢復到原始狀態，移除了錯誤添加的按鈕。

*   **修改原因:**
    *   使用者登入後首先看到的是儀表板頁面，將新功能按鈕放置於此處，能讓使用者更直觀、方便地找到並使用「生成相似題」功能，提升使用者體驗。
    *   修正了按鈕連結的藍圖前綴，確保路由正確解析。

---

這份文件詳細說明了為實現「根據輸入題目生成相似題」功能所做的程式碼修改。

## 總結

為了實現這個新功能，我進行了以下三個核心步驟：
1.  **新增 AI 分析能力**：讓系統能夠「理解」一個數學題目並識別其核心概念。
2.  **建立後端 API**：建立一個服務端點，接收使用者輸入的題目，利用新的 AI 分析能力，並產生相似的題目。
3.  **打造前端使用者介面**：建立一個新的網頁，讓使用者可以方便地輸入題目並看到結果。

以下是針對每個修改檔案的詳細說明：

---

### 1. `core/ai_analyzer.py`

*   **修改說明:**
    *   在此檔案中新增了一個名為 `identify_skills_from_problem` 的函式。
    *   此函式接收一個數學題目的文字內容作為輸入。
    *   它會讀取 `skills` 目錄下的所有技能檔案名稱，並將這些名稱作為一個候選列表傳遞給 Gemini AI 模型。
    *   它會提示 AI 扮演數學專家的角色，分析輸入的題目，並從提供的技能列表中，以 JSON 格式回傳最相關的技能 ID。
    *   函式會解析 AI 的回傳結果，並返回一個包含技能 ID 的 Python 列表。

*   **修改原因:**
    *   這是實現新功能的核心。現有程式碼可以根據已知的技能 ID 生成題目，但缺乏從一個未知題目反向推斷其所需技能的能力。
    *   這個新函式填補了這個缺口，讓應用程式能夠「理解」使用者輸入的題目，並將其對應到系統中已有的數學概念，這是生成相似題目的第一步，也是最關鍵的一步。

---

### 2. `core/routes.py`

*   **修改說明:**
    1.  **新增 API 路由 `/generate-similar-questions` (POST 方法):**
        *   這個路由負責接收前端頁面傳來的、包含使用者輸入題目文字 (`problem_text`) 的請求。
        *   它會呼叫前一步在 `ai_analyzer.py` 中建立的 `identify_skills_from_problem` 函式，以獲取相關的技能 ID 列表。
        *   接著，它會遍歷這些技能 ID，動態地載入對應的 `skills` 模組，並呼叫每個模組中的 `generate()` 函式來產生新的題目。
        *   最後，它將所有新產生的題目整理好，以 JSON 格式回傳給前端頁面。
    2.  **新增頁面路由 `/similar-questions-page` (GET 方法):**
        *   這個路由的功能很簡單，就是渲染並顯示新的 `similar_questions.html` 頁面給使用者。

*   **修改原因:**
    1.  `/generate-similar-questions` 路由是後端邏輯與前端介面的橋樑。它讓前端頁面可以將使用者輸入的題目發送到後端進行處理，並接收處理後產生的新題目。
    2.  `/similar-questions-page` 路由則為使用者提供了一個可以實際操作此功能的入口網址，讓使用者能看到並使用這個新功能。

---

### 3. `templates/similar_questions.html`

*   **修改說明:**
    *   這是一個**全新建立**的 HTML 檔案。
    *   頁面佈局參考了您現有的 `index.html` 檔案，以確保網站的視覺風格和操作體驗保持一致，包含相同的導覽列和整體外觀。
    *   頁面核心包含三個部分：
        1.  一個文字輸入區 (`<textarea>`) 讓使用者可以貼上他們的數學題目。
        2.  一個「產生相似題」的按鈕。
        3.  一個用於顯示 AI 分析結果的區域。
    *   檔案內嵌了 JavaScript 程式碼，用於處理按鈕點擊事件。當使用者點擊按鈕時，它會：
        *   獲取輸入框中的題目文字。
        *   向 `/generate-similar-questions` API 發送請求。
        *   接收到回傳的題目列表後，動態地在結果區域生成卡片來顯示每一道新題目、其所屬的技能以及答案。
        *   呼叫 MathJax 套件來正確且美觀地渲染題目中的數學公式。

*   **修改原因:**
    *   這個檔案為新功能提供了使用者介面 (UI)。如果沒有這個頁面，使用者將無法與我所建立的後端功能進行互動。它將整個功能串連起來，從使用者輸入到結果呈現，提供了一個完整的使用體驗。