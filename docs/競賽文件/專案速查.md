# 🚀 旺宏科學獎專案速查表

> **最後更新**: 2026-01-28 16:50  
> **狀態**: ✅ Ablation Study 框架修復完成 → 實驗獨立性驗證通過

---

## 🎯 核心論點（30 秒版）

**問題**: Gemini Pro 出題成本高（$0.05/題），中小學負擔不起  
**解法**: Local 14B AI + Active Healer 修復機制  
**效果**: 成本降至 $0.001/題（降低 98%），質量僅降 3%

---

## 📐 實驗設計（3×3 矩陣）

```
                 7B        14B       Cloud Pro
直覺 Prompt      40%/30%   60%/50%   90%/85%
工程化 Prompt    55%/45%   75%/65%   95%/90%
工程化+Healer    75%/65%   92%/87%⭐  97%/93%

註：語法率/邏輯率，⭐=目標組
```

**核心假設**:
- H1: Healer 對所有模型都有提升
- H2: 14B+Healer ≈ Cloud Pro（質量相當，成本 1/30）✨
- H3: Healer 對小模型幫助更大（交互作用）
- H4: MASTER_SPEC 本身就能提升質量

---

## 🔧 技術架構

```
Architect (Gemini Flash, 一次性)
    ↓ 產出 MASTER_SPEC
Coder (Qwen 14B, 本地免費)
    ↓ 生成 Python 代碼
Active Healer (四層修復)
    ├─ Step 0: Garbage Cleaner (孤立字元)
    ├─ Step 1: AST Parser (語法檢測)
    ├─ Step 2: Regex Healer (模式修復)
    ├─ Step 3: AST Healer (結構修復)
    └─ Step 4: Eval Eliminator (邏輯修復)
    ↓
Dynamic Sampling (質量驗證)
```

---

## 📊 關鍵指標

| 指標 | 定義 | 目標值 |
|------|------|--------|
| 語法正確率 | AST Parse 成功 / 總數 | 14B+Healer: 92% |
| 邏輯正確率 | Dynamic Sampling 通過 / 總數 | 14B+Healer: 87% |
| 修復成功率 | 修復後通過 / 原始錯誤數 | 87% |
| 成本/質量比 | (邏輯率 / 成本) × 100 | 87,000 vs 2,833 |

---

## 📁 資料庫設計狀態
資料庫路徑 \instance\kumon_math.db
### 核心資料表
- ✅ `skills_info`: 技能定義（20 個測試技能）
- ✅ `skill_gencode_prompt`: MASTER_SPEC 儲存
- ✅ `textbook_examples`: RAG 知識庫
- ✅ `experiment_log`: 實驗數據收集（含所有修復追蹤）

### 需要補充的欄位
- ⚠️ `experiment_log.experiment_group`: 實驗組標記（A/B/C）
- ⚠️ `experiment_log.garbage_cleaner_count`: 細分修復統計
- ⚠️ `experiment_log.eval_eliminator_count`: Eval 修復次數

---

## 🎬 當前進度

### ✅ 已完成
- [x] 核心 Healer 機制實作
- [x] 資料庫 Schema 設計
- [x] 實驗設計（3×3 矩陣）
- [x] 研究計畫書撰寫
- [x] 成功案例：整數四則運算修復
- [x] 回歸測試系統建立（防止修改破壞已成功技能）
- [x] Scripts 標準標頭規範（提升程式碼專業度）
- [x] **Ablation Study 框架修復**（2026-01-28）
  - 發現並修復 Healer 門控邏輯 Bug（3 個代碼段在 Ab1/Ab2 仍執行修復）
  - 驗證實驗獨立性：Ab1/Ab2 正確跳過所有 Healer（Fixes=0）
  - 驗證 Ab3 完整功能正常（Fixes: Regex=7, AST=2）
  - 確保 Ablation 條件真正獨立，實驗結果科學有效

### 🔄 進行中
- [x] **Prompt Engineering 優化**（2026-01-28）
  - 完成 BARE_MINIMAL_PROMPT 迭代（1335 chars）
  - 添加 3 步驟標準流程（math_expr → q_str → clean_latex_output）
  - 添加正確/錯誤範例對照
  - 回歸測試通過率達到 100%（5/5 Golden Skills）
  - LaTeX 格式驗證通過：「中文在外，數學在內」✅
- [ ] 策略調整：放棄「萬能 Healer」，改為「穩定 10 技能流水線」
  - **新目標**: 不追求修復所有技能，專注 10 個核心技能
  - **優勢**: 質量穩定、實驗公信力高、時間可控
  - **進度**: 已有 5 個 Golden Skills（整數四則運算系列），目標 10 個（本週）

### 📅 待辦事項（優先順序）
1. **【本週】** 執行完整 Ablation Study 實驗
   - 使用 5 個 Golden Skills 進行測試
   - 驗證 Ab1 vs Ab2 vs Ab3 的效果差異
   - 收集實驗數據並進行統計分析
2. **【本週】** 擴展 Golden Skills 到 10 個
   - 測試更多簡單技能（分數運算、小數運算）
   - 每個成功後加入 regression_test.py
3. **【下週】** 手動修復複雜技能（如分數四則運算）
   - 修改 MASTER_SPEC 加入更明確的提示
   - 或直接編輯失敗代碼驗證修復方向
4. 資料庫欄位補充（experiment_group 等）
5. 實驗腳本優化（competition_benchmark.py）
6. 完整實驗（10 技能 × 10 次 × 3 組 Ablation）
7. 統計分析（驗證 H4: MASTER_SPEC 提升效果）
8. 展示 PPT 製作
9. 答辯問題準備

---

## 🗂️ 重要檔案路徑

### 競賽文件
- `docs/競賽文件/旺宏科學獎_研究計畫.md` - 完整研究計畫
- `docs/競賽文件/3x3實驗設計詳解.md` - 統計方法說明
- `docs/競賽文件/快速開始指南.md` - 實驗執行步驟
- `docs/競賽文件/資料庫設計驗證報告.md` - Schema 檢驗

### 核心代碼
- `core/ai_wrapper.py` - AI 調用包裝
- `core/prompt_architect.py` - Architect 邏輯
- `core/code_generator.py` - Coder + Healer 邏輯（含 Ablation Study 門控）
- `scripts/competition_benchmark.py` - 實驗執行腳本
- `scripts/visualize_healer.py` - 修復過程可視化
- `scripts/regression_test.py` - 回歸測試系統（5 個 Golden Skills: 整數四則運算系列）
- `scripts/SCRIPT_HEADER_TEMPLATE.md` - 所有 scripts 的標準標頭模板

### 資料庫
- `models.py` - SQLAlchemy Models
- `instance/math_practice.db` - SQLite 資料庫

---

## 🔬 實驗執行快速指令

```powershell
# 可視化修復過程
python scripts/visualize_healer.py

# 小規模測試（3 技能 × 3 次）
python scripts/competition_benchmark.py --skills 3 --trials 3

# 檢查資料庫
python check_db.py

# 查看實驗結果
sqlite3 instance/math_practice.db "SELECT * FROM experiment_log ORDER BY timestamp DESC LIMIT 10;"
```

---

## 💡 快速答辯要點

**Q: 為何不用 70B？**  
A: 70B 需 48GB 顯存（$2000+），14B 只需 16GB（RTX 5060），更普及

**Q: 修復會改變原意嗎？**  
A: 只修復語法錯誤，數學邏輯不變，所有修復經 AST 驗證

**Q: 修復失敗怎麼辦？**  
A: 三層兜底：重試 → 降級 Gemini → 人工審核，失敗率僅 13%

**Q: 能用其他學科嗎？**  
A: 完全可以！Domain-Agnostic 設計，可套用物理、化學、程式題

---

## 📈 下一步行動

### 本週優先（2026-01-28 週）
1. 補充資料庫欄位（experiment_group 等）
2. 執行小規模測試（驗證流程）
3. 建立數據收集 Excel 模板

### 下週目標（2026-02-03 週）
1. 執行中規模實驗（10 技能 × 5 次）
2. 初步統計分析
3. 錯誤類型分類表

### 月底衝刺（2026-02-24 週）
1. 完整實驗（20 技能 × 10 次 × 9 組）
2. Two-Way ANOVA 分析
3. 展示 PPT + Demo 系統

---

## 🏆 成功標準

### 必須達成
- [ ] H2 驗證通過：B3 ≈ C1（p > 0.05）
- [ ] 成本比達到 30:1 以上
- [ ] 完整數據收集（1800+ 實驗記錄）

### 加分項
- [ ] H3 驗證通過：交互作用顯著
- [ ] 現場 Demo 成功（觀眾選題 → 即時生成）
- [ ] 論文引用 3+ 篇相關研究

---

**📝 變更歷史**
- 2026-01-28 16:50: 更新 Ablation Study 框架修復進度
  - 修復 Healer 門控邏輯 Bug（確保 Ab1/Ab2 不執行任何修復）
  - 完成 Prompt Engineering 優化（回歸測試 100% 通過）
  - 5 個 Golden Skills 驗證完成
- 2026-01-28 08:35: 初始建立（基於四份競賽文件）
