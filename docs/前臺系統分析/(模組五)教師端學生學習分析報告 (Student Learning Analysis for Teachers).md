# 教師端的學生學習分析 (Student Learning Analysis for Teachers)
**版本**：2.1 (同步解題三部曲診斷與知識圖譜應用)
**日期**：2025-12-22

## 1. 模組概述 (Overview)

「學生學習分析報告」模組旨在為教師提供一個直觀、數據驅動的決策支援介面。透過整合後端的錯題紀錄 (`MistakeLog`) 與 AI 學習診斷 (`LearningDiagnosis`)，系統能夠自動化地統計全班性的學習痛點，並提供個別學生的深度診斷，協助教師實現精準教學與差異化輔導。

該功能位於教師儀表板 (`Teacher Dashboard`) 的管理功能列中，採用視覺化圖表與結構化列表並呈的設計。

## 2. 資料來源與流向 (Data Sources & Flow)

本模組的分析數據並非憑空產生，而是來自於前臺與後臺系統的深度整合，呼應了 **前臺系統分析** 與 **後臺系統分析** 文件中的架構：

1.  **資料產出端 (前臺)**：
    - 根據 **`智慧適性化練習介面 (Intelligent Adaptive Practice Interface).md`**，學生在進行多模態互動練習（含手寫、作圖）時，系統會即時記錄答題結果與錯誤類型的節點分析。
    - 透過 **「考卷診斷模式」**，學生上傳的實體考卷經 AI 批改後，其弱點數據也會流入資料庫。

2.  **資料結構端 (後臺)**：
    - 根據 **`Smart-Edu Content Generator (SECG).md`**，系統透過知識圖譜 (`Knowledge Graph`) 定義了技能間的依賴關係。這使得分析報告不僅能顯示「錯哪題」，還能進一步透過「推薦單元」指出學生需要回頭修補的基礎技能節點。

## 3. 核心功能詳解 (Key Features)

介面主要劃分為兩大區塊，分別對應「群體」與「個體」兩個分析維度：

### 3.1 群體分析：學生常錯題目統計 (Top 10 Mistakes Analysis)

此區塊幫助教師快速識別課程中學生普遍感到困難的題目或觀念，是調整教學進度與重點的重要依據。
- **介面呈現**: 使用紅色長條圖 (Bar Chart) 呈現，直觀顯示錯誤頻率最高的題目。
- **資料邏輯**: 
    - 系統會撈取全班學生的歷史錯題紀錄 (`MistakeLog`)。
    - 針對相同題目內容 (`question_content`) 進行聚合統計 (`Group By`)。
    - 篩選出錯誤次數最多的前 10 道題目進行排序與展示。
- **教學應用**: 若某題錯誤率極高，代表該觀念（例如：二次函數配方法）可能是全班性的迷思概念，教師可在課堂上統一重新講解，提升教學效率。

### 3.2 個體分析：學生個別學習診斷報告 (Individual Learning Diagnosis)

此區塊提供每位學生的 AI 診斷歷程，讓教師能深入了解個別學生的學習狀況與弱點。
- **介面呈現**: 以清晰的響應式表格 (Table) 列出診斷紀錄。
- **資料欄位**:
    - **日期**: 診斷產生的時間，方便追蹤學生進步軌跡。
    - **學生姓名**: 直接標示學生身分。
    - **系統推薦單元**: 系統依據 **知識圖譜 (Knowledge Graph, 模組四)** 的依賴關係，自動回溯並推薦學生需要回頭複習的基礎單元 (例如：高中多項式卡關 -> 推薦複習國中乘法公式)。
    - **AI 診斷評語**: 結合 **解題三部曲 (Module 3)** 的邏輯，AI 針對學生該次表現生成質性評語，不只指出錯誤，更提供「啟動思考」的建議 (e.g., "觀察這一步的係數...")。
- **資料邏輯**: 關聯 `LearningDiagnosis` 與 `User` 資料表，依時間倒序排列，確保教師看到的是最新的診斷資訊。

## 4. 技術實作 (Technical Implementation)

### 4.1 前端設計 (`templates/teacher_analysis.html`)
- **視覺化引擎**: 採用 **Chart.js** 繪製動態圖表，提供良好的互動體驗（如 Tooltip 顯示完整題目）。
- **版面配置**: 採用卡片式設計 (`Card Layout`)，區隔不同維度的資訊，保持介面清爽。
- **響應式設計 (RWD)**: 支援桌機、平板等多種裝置，方便教師隨時查看。

### 4.2 後端邏輯 (`core/routes.py` - `/teacher/analysis`)
- **聚合查詢**: 使用 SQLAlchemy 的 `func.count` 高效統計錯題數據。
- **關聯查詢**: 透過 `db.session.query(LearningDiagnosis, User.username)` 進行跨表查詢，一次獲取完整的診斷報告。
- **權限控制**: 嚴格限制僅有 `role='teacher'` 的使用者可存取此頁面，確保學生隱私資料安全。

## 5. 預期效益 (Expected Benefits)

1.  **數據驅動教學**: 從「憑經驗感覺」轉向「憑數據說話」，精準定位教學盲點。
2.  **提升輔導效率**: AI 自動生成的診斷評語能作為教師輔導學生的參考底稿，大幅減少人工分析的時間。
3.  **個人化學習路徑**: 透過「推薦單元」功能，教師能更有憑據地指派補救教學內容，真正落實因材施教。
