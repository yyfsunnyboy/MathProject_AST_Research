# 學生上傳題目功能

## 功能概述
允許學生在練習頁面直接上傳含有數學題目的圖片。系統透過 AI (Gemini) 自動辨識圖片中的題目文字並計算正確答案，讓學生能即時針對該題目進行作答練習。

## 系統流程
1. **上傳圖片**：
   - 學生點擊 dashboard 上方的「上傳題目」按鈕。
   - 系統直接導向至 `/practice/custom_upload` (不進行檔案上傳)。
   - 後端 `next_question` 檢測到 `custom_upload` 且 session 無資料時，回傳 placeholder 題目 ("請上傳題目圖片...")。
3. **前端顯示 (`index.html`)**：
   - 顯示 placeholder 題目。
   - 學生使用 `index.html` 原有的 "上傳圖片" (或 "上傳題目") 功能進行實際上傳。
   - 上傳後，觸發 `/upload_question_image`，AI 分析覆蓋題目，介面更新。
4. **作答與批改**：
   - 學生輸入答案或寫入畫布。
   - 點擊提交。
   - 後端 `/check_answer` 呼叫 `skills.custom_upload.check()` 進行比對。
   - 回傳批改結果。

## 技術實作細節

### 1. 新增 Skill Module
**檔案**: `skills/custom_upload.py`
- `check(user_answer, correct_answer)`: 負責比對使用者答案與 AI 計算的正確答案。支援數值寬容度比對。

### 2. 後端 API
**檔案**: `core/routes.py`
- 新增路由 `POST /upload_question_image`。
- 使用 `set_current` 更新 session 中的題目資訊。

**檔案**: `core/ai_analyzer.py`
- 新增 `analyze_question_image(image_file)`。
- Prompt 重點：
  - OCR 準確度 (LaTeX 格式)。
  - Step-by-step 解題以獲取正確答案。
  - 回傳 JSON 格式：`{ "question_text": "...", "correct_answer": "...", "answer_type": "text" }`。

### 3. 前端介面
**檔案**: `templates/index.html`
- 新增按鈕 `#upload-question-btn` 與隱藏 input `#question-image-uploader`。
- 新增 JS 函式 `setupQuestionUpload()`：
  - 處理檔案選擇與 Ajax 上傳。
  - 接收回應後更新 DOM (`#question-text`)。
  - 觸發 MathJax 重新渲染公式。

## 注意事項
- **AI 準確度**：依賴 Gemini 模型的視覺辨識能力，手寫潦草或模糊圖片可能導致辨識錯誤。
- **答案格式**：目前主要支援文字/數值型答案。
- **錯題本**：自訂題目若答錯，目前機制下可能不會存入標準錯題本，因為沒有固定的 Skill ID (或使用 `custom_upload` 作為 ID)。
