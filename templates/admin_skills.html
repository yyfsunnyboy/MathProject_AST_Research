<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ€èƒ½ç®¡ç† - åŠŸæ–‡æ•¸å­¸</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* Navbar */
        .navbar {
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .navbar .logo {
            font-weight: bold;
            font-size: 1.3em;
        }
        .navbar a {
            color: #ecf0f1;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background 0.2s;
            margin-left: 10px;
        }
        .navbar a:hover { background: #34495e; }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
        }
        .btn-add {
            background: #27ae60;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.2s;
        }
        .btn-check {
            background: #8e44ad;
            color: white;
            margin-left: 15px;
        }
        .btn-check:hover { background: #732d91; }

        .btn-add:hover { background: #229954; }

        /* Alert */
        .alert {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid transparent;
        }
        .alert-success { background: #d4edda; color: #155724; border-color: #c3e6cb; }
        .alert-warning { background: #fff3cd; color: #856404; border-color: #ffeeba; }
        .alert-danger { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }

        /* ç¯©é¸å™¨æ¨£å¼ */
        .filter-bar {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        /* Skills Table */
        .skills-table {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        thead {
            background: #34495e;
            color: white;
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        th {
            font-weight: 600;
            font-size: 0.95em;
        }
        tbody tr:hover {
            background: #f8f9fa;
        }
        /* æŠ€èƒ½ ID æ¨£å¼å„ªåŒ– */
        td code {
            background: #f8f9fa;
            padding: 6px 12px;
            border-radius: 5px;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 0.95em;
            font-weight: 600;
            color: #2c3e50;
            border: 1px solid #dee2e6;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        /* Action Buttons */
        .btn-group {
            display: flex;
            gap: 8px;
        }
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        .btn-edit { background: #3498db; color: white; }
        .btn-edit:hover { background: #2980b9; }
        .btn-toggle { background: #f39c12; color: white; }
        .btn-toggle:hover { background: #e67e22; }
        .btn-delete { background: #e74c3c; color: white; }
        .btn-delete:hover { background: #c0392b; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
            overflow-y: auto; /* å…è¨±æ•´å€‹æ¨¡æ…‹æ¡†æ»¾å‹• */
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background: white;
            margin: 30px auto; /* ç¸®å°ä¸Šä¸‹é‚Šè· */
            padding: 25px 30px; /* ç¸®å°å…§è· */
            width: 90%;
            max-width: 600px;
            max-height: 90vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
            border-radius: 10px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            animation: slideDown 0.3s;
            overflow-y: auto; /* å…§å®¹å€åŸŸå¯æ»¾å‹• */
        }
        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            color: #2c3e50;
        }
        .close {
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close:hover { color: #000; }

        /* Form */
        .form-group {
            margin-bottom: 18px; /* ç¸®å°é–“è· */
        }
        .form-group label {
            display: block;
            margin-bottom: 6px; /* ç¸®å°é–“è· */
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.95em;
        }
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 0.95em; /* ç¨å¾®ç¸®å°å­—é«” */
            transition: border-color 0.2s;
        }
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.1);
        }
        .form-group textarea {
            min-height: 70px; /* ç¸®å°é è¨­é«˜åº¦ */
            max-height: 150px; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
            resize: vertical;
            font-family: 'Courier New', Consolas, monospace; /* ç­‰å¯¬å­—é«” */
            font-size: 0.9em;
        }
        /* é‡å° Gemini Prompt çš„æ–‡å­—å€åŸŸï¼Œæä¾›æ›´å¤§çš„ç·¨è¼¯ç©ºé–“ */
        .gemini-prompt-textarea {
            min-height: 140px; /* åŸæœ¬ 70px çš„å…©å€ */
            max-height: 300px; /* åŸæœ¬ 150px çš„å…©å€ */
        }
        .form-group small {
            display: block;
            margin-top: 4px;
            color: #6c757d;
            font-size: 0.85em;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        .btn-submit {
            background: #27ae60;
            color: white;
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.2s;
        }
        .btn-submit:hover { background: #229954; }
        .btn-cancel {
            background: #95a5a6;
            color: white;
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.2s;
        }
        .btn-cancel:hover { background: #7f8c8d; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        .empty-state h3 {
            margin-bottom: 10px;
            color: #95a5a6;
        }
        /* Ghost Skills Modal List */
        .ghost-list {
            list-style-type: none;
            padding: 0;
        }
        .ghost-list li {
            background: #f1f2f6;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
            font-family: 'Courier New', Consolas, monospace;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="logo">ğŸ“ åŠŸæ–‡æ•¸å­¸ - æŠ€èƒ½ç®¡ç†</div>
        <div>
            <a href="{{ url_for('dashboard') }}">è¿”å›å„€è¡¨æ¿</a>
            <a href="{{ url_for('logout') }}">ç™»å‡º</a>
        </div>
    </div>

    <!-- Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>æŠ€èƒ½ç®¡ç†ä¸­å¿ƒ</h1>
            <div>
                <button class="btn-add btn-check" onclick="checkGhostSkills()">ğŸ” æª¢æŸ¥å¹½éˆç¨‹å¼</button>
                <button class="btn-add" onclick="openAddModal()">â• æ–°å¢å–®å…ƒ</button>
            </div>
        </div>

        <!-- ç¯©é¸å™¨ -->
        <div class="filter-bar">
            <form id="filterForm" method="GET" action="{{ url_for('admin_skills') }}" style="display: flex; gap: 15px; align-items: center;">
                <label for="category_filter" style="font-weight: 600;">ä¾é¡åˆ¥ç¯©é¸ï¼š</label>
                <select id="category_filter" name="category" onchange="this.form.submit()" style="padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                    <option value="">æ‰€æœ‰é¡åˆ¥</option>
                    {% for category in categories %}
                    <option value="{{ category }}" {% if selected_category == category %}selected{% endif %}>{{ category }}</option>
                    {% endfor %}
                </select>
                <a href="{{ url_for('admin_skills') }}" class="btn" style="background: #7f8c8d; color: white;">æ¸…é™¤ç¯©é¸</a>
            </form>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- Skills Table -->
        {% if skills %}
        <div class="skills-table">
            <table>
                <thead>
                    <tr>
                        <th>æ’åº</th>
                        <th>æŠ€èƒ½ ID</th>
                        <th>è‹±æ–‡åç¨±</th>
                        <th>ä¸­æ–‡åç¨±</th>
                        <th>é¡åˆ¥</th>
                        <th>ä½œç­”é¡å‹</th>
                        <th>æ™‰ç´šé–€æª»</th>
                        <th>ç‹€æ…‹</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for skill in skills %}
                    <tr>
                        <td>{{ skill.order_index }}</td>
                        <td><code>{{ skill.skill_id }}</code></td>
                        <td>{{ skill.skill_en_name }}</td>
                        <td><strong>{{ skill.skill_ch_name }}</strong></td>
                        <td>{{ skill.category }}</td>
                        <td>{{ skill.input_type }}</td>
                        <td>{{ skill.consecutive_correct_required }} é¡Œ</td>
                        <td>
                            <span class="status-badge status-{{ 'active' if skill.is_active else 'inactive' }}">
                                {{ 'å•Ÿç”¨' if skill.is_active else 'åœç”¨' }}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-edit" 
                                        data-skill='{{ skill.to_dict() | tojson | e }}' 
                                        onclick='openEditModal(this.dataset.skill)'>
                                    ç·¨è¼¯</button>
                                <form method="POST" action="{{ url_for('admin_toggle_skill', skill_id=skill.skill_id) }}" style="display: inline;">
                                    <button type="submit" class="btn btn-toggle">
                                        {{ 'åœç”¨' if skill.is_active else 'å•Ÿç”¨' }}
                                    </button>
                                </form>
                                <form method="POST" action="{{ url_for('admin_delete_skill', skill_id=skill.skill_id) }}" 
                                      onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤ã€Œ{{ skill.skill_ch_name }}ã€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')" 
                                      style="display: inline;">
                                    <button type="submit" class="btn btn-delete">åˆªé™¤</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <h3>ç›®å‰æ²’æœ‰ä»»ä½•æŠ€èƒ½</h3>
            <p>é»æ“Šå³ä¸Šè§’ã€Œæ–°å¢æŠ€èƒ½ã€æŒ‰éˆ•é–‹å§‹å»ºç«‹ç·´ç¿’ä¸»é¡Œ</p>
        </div>
        {% endif %}
    </div>

    <!-- Add Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ–°å¢æŠ€èƒ½</h2>
                <span class="close" onclick="closeModal('addModal')">&times;</span>
            </div>
            <form method="POST" action="{{ url_for('admin_add_skill') }}">
                <div class="form-group">
                    <label for="skill_id">æŠ€èƒ½ ID *</label>
                    <input type="text" id="skill_id" name="skill_id" required
                           pattern="^[a-z_]+$"
                           placeholder="ä¾‹å¦‚ï¼šquadratic_equation">
                    <small>åªèƒ½ä½¿ç”¨å°å¯«è‹±æ–‡å­—æ¯å’Œåº•ç·šï¼Œä¾‹å¦‚ï¼šremainderã€factor_theorem</small>
                </div>
                <div class="form-group">
                    <label for="skill_en_name">è‹±æ–‡åç¨± *</label>
                    <input type="text" id="skill_en_name" name="skill_en_name" required 
                           placeholder="ä¾‹å¦‚ï¼šQuadratic Equation">
                </div>
                <div class="form-group">
                    <label for="skill_ch_name">ä¸­æ–‡åç¨± *</label>
                    <input type="text" id="skill_ch_name" name="skill_ch_name" required 
                           placeholder="ä¾‹å¦‚ï¼šä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼">
                </div>
                <div class="form-group">
                    <label for="category">æŠ€èƒ½é¡åˆ¥ *</label>
                    <input type="text" id="category" name="category" required 
                           placeholder="ä¾‹å¦‚ï¼šå¤šé …å¼ã€ä¸‰è§’å‡½æ•¸">
                </div>
                <div class="form-group">
                    <label for="input_type">ä½œç­”é¡å‹ *</label>
                    <select id="input_type" name="input_type" required>
                        <option value="text" selected>æ–‡å­—è¼¸å…¥ (text)</option>
                        <option value="handwriting">æ‰‹å¯«ä½œç­” (handwriting)</option>
                    </select>
                    <small>æ±ºå®šæ­¤å–®å…ƒåœ¨ç·´ç¿’é é¢çš„ä¸»è¦ä½œç­”æ–¹å¼ã€‚</small>
                </div>
                <div class="form-group">
                    <label for="description">æè¿° *</label>
                    <textarea id="description" name="description" required 
                              placeholder="ç°¡çŸ­æè¿°é€™å€‹æŠ€èƒ½çš„å­¸ç¿’ç›®æ¨™"></textarea>
                </div>
                <div class="form-group">
                    <label for="gemini_prompt">Gemini æç¤ºæ¨¡æ¿ *</label>
                    <textarea id="gemini_prompt" name="gemini_prompt" required class="gemini-prompt-textarea"
                              placeholder="åˆ†æå­¸ç”Ÿç­”æ¡ˆï¼š{user_answer}ï¼Œæ­£ç¢ºç­”æ¡ˆï¼š{correct_answer}ï¼Œå¦‚æœéŒ¯èª¤ï¼Œæ•™å°..."></textarea>
                    <small>å¯ç”¨è®Šæ•¸ï¼š{user_answer}ã€{correct_answer}ã€{context}</small>
                </div>
                <div class="form-group">
                    <label for="consecutive_correct_required">æ™‰ç´šé–€æª»ï¼ˆé€£çºŒç­”å°é¡Œæ•¸ï¼‰*</label>
                    <input type="number" id="consecutive_correct_required" name="consecutive_correct_required" 
                           value="10" min="1" max="50" required>
                </div>
                <div class="form-group">
                    <label for="order_index">æ’åºé †åº</label>
                    <input type="number" id="order_index" name="order_index" value="999" min="0">
                    <small>æ•¸å­—è¶Šå°è¶Šå‰é¢ï¼Œé è¨­ 999</small>
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="is_active" name="is_active" checked>
                        <label for="is_active" style="margin: 0;">ç«‹å³å•Ÿç”¨</label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeModal('addModal')">å–æ¶ˆ</button>
                    <button type="submit" class="btn-submit">æ–°å¢</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç·¨è¼¯æŠ€èƒ½</h2>
                <span class="close" onclick="closeModal('editModal')">&times;</span>
            </div>
            <form id="editForm" method="POST">
                <div class="form-group">
                    <label>æŠ€èƒ½ ID</label>
                    <input type="text" id="edit_skill_id" disabled 
                           style="background: #e9ecef; cursor: not-allowed;">
                    <small>æŠ€èƒ½ ID ç„¡æ³•ä¿®æ”¹</small>
                </div>
                <div class="form-group">
                    <label for="edit_skill_en_name">è‹±æ–‡åç¨± *</label>
                    <input type="text" id="edit_skill_en_name" name="skill_en_name" required>
                </div>
                <div class="form-group">
                    <label for="edit_skill_ch_name">ä¸­æ–‡åç¨± *</label>
                    <input type="text" id="edit_skill_ch_name" name="skill_ch_name" required>
                </div>
                <div class="form-group">
                    <label for="edit_category">æŠ€èƒ½é¡åˆ¥ *</label>
                    <input type="text" id="edit_category" name="category" required>
                </div>
                <div class="form-group">
                    <label for="edit_input_type">ä½œç­”é¡å‹ *</label>
                    <select id="edit_input_type" name="input_type" required>
                        <option value="text">æ–‡å­—è¼¸å…¥ (text)</option>
                        <option value="handwriting">æ‰‹å¯«ä½œç­” (handwriting)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit_description">æè¿° *</label>
                    <textarea id="edit_description" name="description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="edit_gemini_prompt">Gemini æç¤ºæ¨¡æ¿ *</label>
                    <textarea id="edit_gemini_prompt" name="gemini_prompt" required class="gemini-prompt-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label for="edit_consecutive_correct_required">æ™‰ç´šé–€æª» *</label>
                    <input type="number" id="edit_consecutive_correct_required" 
                           name="consecutive_correct_required" min="1" max="50" required>
                </div>
                <div class="form-group">
                    <label for="edit_order_index">æ’åºé †åº</label>
                    <input type="number" id="edit_order_index" name="order_index" min="0">
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="edit_is_active" name="is_active">
                        <label for="edit_is_active" style="margin: 0;">å•Ÿç”¨</label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeModal('editModal')">å–æ¶ˆ</button>
                    <button type="submit" class="btn-submit">å„²å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ghost Skills Check Modal -->
    <div id="ghostModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>å¹½éˆç¨‹å¼æª¢æŸ¥çµæœ</h2>
                <span class="close" onclick="closeModal('ghostModal')">&times;</span>
            </div>
            <div id="ghostResult">
                <p>æ­£åœ¨æª¢æŸ¥ä¸­...</p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="closeModal('ghostModal')">é—œé–‰</button>
            </div>
        </div>
    </div>

    <script>
        function openAddModal() {
            document.getElementById('addModal').style.display = 'block';
        }

        function openEditModal(skillJson) {
            const skill = JSON.parse(skillJson);
            document.getElementById('edit_skill_id').value = skill.skill_id;
            document.getElementById('edit_skill_en_name').value = skill.skill_en_name;
            document.getElementById('edit_skill_ch_name').value = skill.skill_ch_name;
            document.getElementById('edit_category').value = skill.category;
            document.getElementById('edit_input_type').value = skill.input_type || 'text';
            document.getElementById('edit_description').value = skill.description;
            document.getElementById('edit_gemini_prompt').value = skill.gemini_prompt;
            document.getElementById('edit_consecutive_correct_required').value = skill.consecutive_correct_required;
            document.getElementById('edit_order_index').value = skill.order_index;
            document.getElementById('edit_is_active').checked = skill.is_active == 1;
            
            document.getElementById('editForm').action = `/admin/skills/edit/${skill.skill_id}`;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        async function checkGhostSkills() {
            const modal = document.getElementById('ghostModal');
            const resultDiv = document.getElementById('ghostResult');
            modal.style.display = 'block';
            resultDiv.innerHTML = '<p>æ­£åœ¨æª¢æŸ¥ä¸­ï¼Œè«‹ç¨å€™...</p>';

            try {
                const response = await fetch("{{ url_for('core.check_ghost_skills') }}");
                const data = await response.json();

                if (data.success) {
                    if (data.ghost_files.length > 0) {
                        let fileListHtml = '<p>ä»¥ä¸‹æª”æ¡ˆå­˜åœ¨æ–¼ `skills` è³‡æ–™å¤¾ä¸­ï¼Œä½†åœ¨è³‡æ–™åº« `skills_info` è¡¨æ ¼å…§æ²’æœ‰å°æ‡‰çš„ç´€éŒ„ã€‚è«‹ç¢ºèªå¾Œæ‰‹å‹•åˆªé™¤ï¼š</p>';
                        fileListHtml += '<ul class="ghost-list">';
                        data.ghost_files.forEach(file => {
                            fileListHtml += `<li>${file}.py</li>`;
                        });
                        fileListHtml += '</ul>';
                        resultDiv.innerHTML = fileListHtml;
                    } else {
                        resultDiv.innerHTML = '<p style="color: #155724; font-weight: bold;">å¤ªæ£’äº†ï¼æ²’æœ‰ç™¼ç¾ä»»ä½•å¹½éˆç¨‹å¼ã€‚</p>';
                    }
                } else {
                    resultDiv.innerHTML = `<p style="color: #721c24;">æª¢æŸ¥å¤±æ•—ï¼š${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: #721c24;">ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨æˆ–ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ã€‚</p>`;
            }
        }

        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        window.onclick = function(event) {
            const modals = ['addModal', 'editModal', 'ghostModal'];
            if (modals.map(id => document.getElementById(id)).includes(event.target)) {
                event.target.style.display = 'none';
            }
        }

        // ESC éµé—œé–‰
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal('addModal');
                closeModal('editModal');
                closeModal('ghostModal');
            }
        });
    </script>
</body>
</html>