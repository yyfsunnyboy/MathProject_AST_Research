# 專案 Excel 檔案詳細分析報告 (進階版)

## 總結

經過對 `models.py` 資料庫結構的深入分析，我能更精準地解釋各個 Excel 檔案的用途。

*   **主動使用的檔案**：只有 **`知識點鏈結/課綱.xlsx`** 被現有的匯入腳本 (`import_data.py`, `import_curriculum.py`) 直接讀取，作為初始化資料庫的主要來源。

*   **核心資料主檔案 (Master Files)**：檔案如 `skill_info_all.xlsx`, `skill_curriculum_all.xlsx`, 和 `skill_prerequisites_all.xlsx` 是最關鍵的資料來源。它們的結構與資料庫中的核心表格 `skills_info`, `skill_curriculum`, `skill_prerequisites` 完全對應。雖然目前沒有程式會自動讀取它們，但它們是手動維護整個系統知識體系與課程結構的**源頭**。可以說，這些檔案是整個系統的「設計藍圖」。

*   **文件**：`docs/Table Schema.xlsx` 是純粹的開發者參考文件。

以下是基於資料庫結構的詳細分析：

---

## 1. `datasource/data source_課程資料/skill_info_all.xlsx` (技能資訊主檔案)

此檔案是系統中所有「技能」的定義總表，對應資料庫中的 `skills_info` 表格。它定義了一個技能的內在屬性。

*   **整體功能**:
    維護系統中每一個獨立的數學技能（知識點）。任何一個可以被練習的單元，其所有屬性都在此定義。

*   **在程式中的角色**:
    雖然目前沒有程式自動讀取此檔案，但一旦資料被匯入 `skills_info` 表格，就會在整個應用程式中被頻繁使用：
    *   在**儀表板**上顯示技能的中文名稱、分類和描述。
    *   在**練習頁面**，`gemini_prompt` 欄位會被用來生成與 AI 助教的對話內容。
    *   `is_active` 欄位決定了這個技能是否對使用者可見。
    *   `input_type` 決定了使用者是以打字還是手寫方式作答。

*   **推斷的欄位詳解**:
    *   `skill_id` (文字): **系統核心 ID**。這是技能的唯一英文識別碼，例如 `linear_equation`。它被用來連結 `skills` 目錄下的 Python 程式碼檔案，**絕對不能重複**。
    *   `skill_en_name` (文字): 技能的英文名稱。
    *   `skill_ch_name` (文字): 技能的中文名稱，例如「一元一次方程式」，會直接顯示給使用者看。
    *   `category` (文字): 技能分類，例如「多項式」、「三角函數」。用於在儀表板上對技能進行分組。
    *   `description` (文字): 對此技能的詳細文字描述。
    *   `input_type` (文字): 定義作答方式。應為 `text` (文字輸入) 或 `handwriting` (手寫作答)。
    *   `gemini_prompt` (文字): **AI 助教的行為核心**。這是一個包含特定指令的文字模板，當使用者在練習此技能時向 AI 提問，系統會將這個模板傳給 Gemini AI，以生成更具針對性的回答。
    *   `consecutive_correct_required` (數字): 晉級所需的連續答對次數，實踐「功文式教育」理念的核心參數。
    *   `is_active` (布林值): `TRUE` 或 `FALSE`。用來控制此技能是否在系統中啟用。設為 `FALSE` 可以暫時對使用者隱藏此技能。
    *   `order_index` (數字): 排序索引。用來決定技能在儀表板同一分類下的顯示順序。

---

## 2. `datasource/data source_課程資料/skill_curriculum_all.xlsx` (課程綱要主檔案)

此檔案定義了每個技能在**不同學制和課本**中的位置，對應資料庫中的 `skill_curriculum` 表格。

*   **整體功能**:
    建構出整個數學課程的結構樹。它回答了「哪個技能在哪個年級、哪本課本的哪個章節」這個問題。

*   **在程式中的角色**:
    匯入資料庫後，`skill_curriculum` 表格的資料主要被**儀表板**使用，來動態產生課程選單，讓使用者可以根據學校的教學進度來找到對應的練習。同時，`difficulty_level` 欄位會影響出題難度。

*   **推斷的欄位詳解**:
    *   `skill_id` (文字): 關聯到 `skills_info` 表格的 `skill_id`，指明這是關於哪個技能的課程設定。
    *   `curriculum` (文字): 學制。例如 `general` (普通高中), `vocational` (技術型高中), `junior_high` (國民中學)。
    *   `grade` (數字): 年級。例如 `10`, `11`, `12`。
    *   `volume` (文字): 冊別或課本名稱。例如「數學1」、「數學3A」、「數學4B」。
    *   `chapter` (文字): 章節名稱。例如「第一章 多項式」。
    *   `section` (文字): 小節名稱。例如「1-2 餘式定理」。
    *   `paragraph` (文字): (可選) 更細的段落。
    *   `display_order` (數字): 用於在儀表板的同一小節中對技能進行排序。
    *   `difficulty_level` (數字): **難度控制核心**。定義了某個技能在**這個特定課程**下的預設難度等級（例如 1 或 2）。當使用者從儀表板進入練習時，系統會用這個值來決定要產生哪個難度的題目。

---

## 3. `datasource/data source_課程資料/skill_prerequisites_all.xlsx` (技能依賴主檔案)

此檔案定義了技能與技能之間的**前置學習關係**，對應資料庫中的 `skill_prerequisites` 表格。

*   **整體功能**:
    建構出整個系統的「知識圖譜」。它定義了學習路徑，指明要學會 A 技能前，必須先學會 B 技能。

*   **在程式中的角色**:
    匯入資料庫後，`skill_prerequisites` 表格的資料主要用於**練習頁面**：
    *   當使用者連續答錯時，系統會查詢此表格，找出當前技能的前置技能，並向使用者推薦返回去練習基礎。
    *   AI 助教也可以利用這些資訊，建議觀念不穩的學生先複習哪個基礎知識點。

*   **推斷的欄位詳解**:
    *   `skill_id` (文字): 目標技能的 ID。
    *   `prerequisite_id` (文字): 要學習 `skill_id` 之前，必須先學會的前置技能的 ID。

---

## 4. `知識點鏈結/課綱.xlsx` (當前使用的匯入檔案)

*   **整體功能**:
    這是目前**唯一被程式碼主動讀取並用來初始化資料庫的檔案**。它很可能是從上述幾個 `_all.xlsx` 主檔案中摘錄、整理出來的「生產版本」。

*   **在程式中的角色**:
    *   被 `import_data.py` 和 `import_curriculum.py` 讀取。
    *   腳本會根據此檔案的內容，清空並重建資料庫中的 `Skill` 相關表格。因此，**修改這個檔案並執行對應的匯入腳本，是目前更新系統技能和課程內容的唯一途徑**。

*   **欄位分析**:
    *   它包含的欄位是 `skill_info` 和 `skill_curriculum` 的混合體，至少包括 `年級`, `大單元`, `小單元`, `內容`, 和 `generator_key`。

---

## 5. `docs/Table Schema.xlsx` (文件)

*   **整體功能**:
    這是一個給開發者看的**純文件**，用來解釋資料庫的設計。它很可能是 `models.py` 內容的視覺化版本，讓人更容易理解各個表格的欄位和關聯。

*   **在程式中的角色**:
    沒有任何程式角色，不會被任何程式碼讀取。